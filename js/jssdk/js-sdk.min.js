!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(e="undefined"!=typeof globalThis?globalThis:e||self).jssdk=o()}(this,(function(){"use strict";var e,o;const n=null===(o=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.userAgent)||void 0===o?void 0:o.toLocaleLowerCase(),r=-1!==(null==n?void 0:n.indexOf("android")),t=Symbol("currentRoute"),i=Symbol("isInitd"),a=Symbol("tabBar"),l=Symbol("canNavigateTo"),s="__ma__global__",c={[t]:"",[i]:!1,[a]:null,[l]:!0};function u(e,o){c[e]=o}function d(e){return window[s][e]}window[s]=c;const f={MiniProgram:{NAVIGATE_TO:"navigateTo",NAVIGATE_BACK:"navigateBack",REDIRECT_TO:"redirectTo",SWITCH_TAB:"switchTab",RE_LAUNCH:"reLaunch",POST_MESSAGE:"postMessage",CLOSE:"close"},Native:{CHOOSE_IMAGE:"chooseImage",GET_LOCAL_IMG_DATA:"getLocalImgData",GET_LOCATION:"getLocation",PREVIEW_IMAGE:"previewImage",OPEN_DOCUMENT:"openDocument",GET_STORAGE:"getStorage",SET_STORAGE:"setStorage",REMOVE_STORAGE:"removeStorage",CLEAR_STORAGE:"clearStorage",GET_NETWORK_TYPE:"getNetworkType",SCAN_CODE:"scanCode"}},v=void 0!==window.parent.__simulatorConfig__,g={};let m=0;function p(e,o={},n){const t=JSON.stringify(o),i=++m;g[i]=n,function(e,o,n){v?window.simulatorWebkit.messageHandlers.invoke.postMessage({command:e,inputParams:o,callbackId:n,type:"legacy"}):r?window.viewLayerNative.invoke(e,o,n):window.webkit.messageHandlers.invoke.postMessage({command:e,inputParams:o,callbackId:n})}(e,t,i)}const T={},E="ma_custom_event_";function _(e,o){T[`${E}${e}`]=o}function b(e,o={}){const n=JSON.stringify(o);h(`${E}${e}`,n)}function h(e,o){v?window.simulatorWebkit.messageHandlers.notifyNative.postMessage({eventName:e,paramsString:o,type:"legacy"}):r?window.viewLayerNative.notifyNative(e,o):window.webkit.messageHandlers.notifyNative.postMessage({eventName:e,paramsString:o})}const S={invoke:p,invokeMethod:function(e,o,n={}){const r={};for(const e in o)"function"==typeof o[e]&&(r[e]=o[e],delete o[e]);p(e,o,((e,o)=>{var t,i,a,l,s,c,u,d,f;const v=0===Number(e),g=!v;v&&(null===(t=null==n?void 0:n.beforeAll)||void 0===t||t.call(n,o),null===(i=null==n?void 0:n.beforeSuccess)||void 0===i||i.call(n,o),null===(a=r.success)||void 0===a||a.call(r,o),null===(l=null==n?void 0:n.afterSuccess)||void 0===l||l.call(n,o)),g&&(null===(s=null==n?void 0:n.beforeFail)||void 0===s||s.call(n,o),null===(c=r.fail)||void 0===c||c.call(r,o),null===(u=null==n?void 0:n.afterFail)||void 0===u||u.call(n,o)),null===(d=r.complete)||void 0===d||d.call(r,o),null===(f=null==n?void 0:n.afterAll)||void 0===f||f.call(n,o)}))},subscribe:_,webSubscribe:function(e,o){T[e]=o},publish:b,webPublish:function(e,o={}){h(e,JSON.stringify(o))}};function M(){if(!d(i)){u(i,!0);try{_("getCurrentRoute",(e=>{u(t,e.route),u(a,e.tabBar),u(l,void 0===e.canNavigateTo||e.canNavigateTo)})),b("getCurrentRoute")}catch(e){}}}function A(e,o,n=!0){let r,t,i=o;if(n&&(i=function(e){const o=e.split("?");return o[0]+=".html",void 0===o[1]?o[0]:`${o[0]}?${o[1]}`}(i)),i.startsWith("/"))return i.substr(1);if(i.startsWith("./"))return A(e,i.substr(2),!1);const a=i.split("/");for(r=0,t=a.length;r<t&&".."===a[r];r++);a.splice(0,r);const l=e.length>0?e.split("/"):[];return l.splice(l.length-r-1,r+1),l.concat(a).join("/")}function O(e){const o=e.split("?"),[n,r]=o;if(!r)return e;const t=r.split("&").reduce(((e,o)=>{if("string"==typeof o&&o.length>0){const n=o.split("="),r=n[0],t=n[1];e[r]=t}return e}),Object.create(null)),i=[];for(const e in t)i.push(e+"="+encodeURIComponent(t[e]));return i.length>0?n+"?"+i.join("&"):e}function w(e,o){const n=d(a);if(null===n)return!0;o.url.startsWith("/")&&(o.url=o.url.slice(1));const r=(t=o.url,null==n?void 0:n.list.find((e=>0===t.indexOf(e.pagePath))));var t;return e!==f.MiniProgram.NAVIGATE_TO&&e!==f.MiniProgram.REDIRECT_TO||!r?!(e===f.MiniProgram.SWITCH_TAB&&!r)||(console.error(e,o,`${e}: can not ${e} to a non-tabbar page`),!1):(console.error(e,o,`${e}: can not ${e} to a tabbar page`),!1)}function N(e,o={},n){n&&"function"==typeof n?S.invoke(e,o,((e,o)=>{0===Number(e)?n(o):console.error(`callNativeAPI failed, ${o.errMsg}`)})):console.error("callNativeAPI failed, callback should be function!")}const y={miniProgram:{getEnv:function(e){e({miniprogram:"miniprogram"===window.__ma_environment})},navigateTo:function(e){if(!e.url)return void console.error("navigateTo fail,parameter error:parameter.url should be String instead of Undefined.");const o=e;o.url=A(d(t),o.url),o.url=O(o.url),w(f.MiniProgram.NAVIGATE_TO,o)&&S.invokeMethod(f.MiniProgram.NAVIGATE_TO,o)},navigateBack:function(e){const o=Object.assign({delta:1},e);S.invokeMethod(f.MiniProgram.NAVIGATE_BACK,o)},switchTab:function(e){if(!e.url)return void console.error("switchTab fail,parameter error:parameter.url should be String instead of Undefined.");const o=e;o.url=A(d(t),o.url),o.url=O(o.url),w(f.MiniProgram.SWITCH_TAB,o)&&S.invokeMethod(f.MiniProgram.SWITCH_TAB,o)},reLaunch:function(e){if(!e.url)return void console.error("reLaunch fail,parameter error:parameter.url should be String instead of Undefined.");const o=e;o.url=A(d(t),o.url),o.url=O(o.url),w(f.MiniProgram.RE_LAUNCH,o)&&S.invokeMethod(f.MiniProgram.RE_LAUNCH,o)},redirectTo:function(e){if(!e.url)return void console.error("redirectTo fail,parameter error:parameter.url should be String instead of Undefined.");const o=e;o.url=A(d(t),o.url),o.url=O(o.url),w(f.MiniProgram.REDIRECT_TO,o)&&S.invokeMethod(f.MiniProgram.REDIRECT_TO,o)},postMessage:function(e){S.invokeMethod(f.MiniProgram.POST_MESSAGE,e)},close:function(){S.invokeMethod(f.MiniProgram.CLOSE)},navigateToMiniProgram(){},navigateBackMiniProgram(){},onWebviewEvent(){},offWebviewEvent(){},sendWebviewEvent(){},onShow(){},onHide(){},onUnload(){}},chooseImage:function(e){const o=Object.assign({count:9,sizeType:["original","compressed"],sourceType:["album","camera"]},e);S.invokeMethod(f.Native.CHOOSE_IMAGE,o)},getLocation:function(e){S.invokeMethod(f.Native.GET_LOCATION,e)},previewImage:function(e){(null==e?void 0:e.urls)?S.invokeMethod(f.Native.PREVIEW_IMAGE,e):console.error("previewImage fail,parameter error:parameter.urls should be Array instead of Undefined.")},openDocument:function(e){if(!(null==e?void 0:e.filePath))return void console.error("openDocument fail,parameter error:parameters.filePath should be String instead of Undefined.");e.fileType&&-1===["doc","docx","xls","xlsx","ppt","pptx","pdf"].indexOf(e.fileType)?console.error("openDocument fail,parameter error:parameter.fileType is invalid value."):S.invokeMethod(f.Native.OPEN_DOCUMENT,e)},getStorage:function(e){(null==e?void 0:e.key)?S.invokeMethod(f.Native.GET_STORAGE,e):console.error("getStorage fail,parameter error:parameters.key should be String instead of Undefined.")},setStorage:function(e){(null==e?void 0:e.key)&&e.data?S.invokeMethod(f.Native.SET_STORAGE,e):console.error("setStorage fail,parameter error:parameter.key or parameter.data should not be Undefined.")},removeStorage:function(e){(null==e?void 0:e.key)?S.invokeMethod(f.Native.REMOVE_STORAGE,e):console.error("removeStorage fail,parameter error:parameter.key should be String instead of Undefined.")},clearStorage:function(e){S.invokeMethod(f.Native.CLEAR_STORAGE,e)},getNetworkType:function(e){S.invokeMethod(f.Native.GET_NETWORK_TYPE,e)},scanCode:function(e){const o=["barCode","qrCode","datamatrix","pdf417"];if((null==e?void 0:e.scanType)&&e.scanType.length>0&&!e.scanType.every((e=>o.indexOf(e)>-1)))return void console.error("scanCode fail,parameter error:parameter.scanType contains invalid values.");const n=Object.assign({onlyFromCamera:!1,scanType:["barCode","qrCode"]},e);S.invokeMethod(f.Native.SCAN_CODE,n)},getLocalImgData:function(e){(null==e?void 0:e.path)?S.invokeMethod(f.Native.GET_LOCAL_IMG_DATA,e):console.error("getLocalImgData fail,parameter error:parameter.path should be String instead of Undefined.")},callNativeAPI:N,native:function(e,o){const n=o||{};return new Promise((o=>{N(e,n,(e=>{o(e)}))}))}};return"loading"!==document.readyState?M():document.addEventListener("DOMContentLoaded",M),window.ma=y,window.viewLayer={onInvokeFinished:function(e,o,n){(0,g[e])(o,n),delete g[e]},subscribeHandler:function(e,o){return(0,T[e])(o)}},y}));
